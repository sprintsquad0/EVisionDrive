<!DOCTYPE html>
<html>
<head>
  <style>
    /* Default body styling */
    body{
      background:#11192c;
    } 
    body {
      font-family: 'Arial', sans-serif;
      
      color: #ddd;
      padding: 20px;
      text-align: center;
    }
    
    h2 {
      color: #4caf50;
      margin-bottom: 20px;
      font-size: 28px;
      text-transform: uppercase;
      letter-spacing: 2px;
      border-bottom: 2px solid #4caf50;
      display: inline-block;
      padding-bottom: 5px;
    }
  
  a {
    height:20px;
    width:200px;
    display: block;


    margin:0 auto;

    color: #fff;
    padding: 10px 0;

    text-decoration: none;
    margin-bottom: 15px;
    background: rgba(76, 175, 80, 0.8);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.7);
    transition: all 0.3s ease;
    font-size: 15px;
    font-weight: bold;
    letter-spacing: 1px;
  }
  

/* Mobile layout adjustments */
@media (min-width: 289px) {
 /* Mobile layout adjustments */

  body {
    background: #11192c;
  }

  /* Flex layout for the entire button container */
  div {
    display: flex;
    flex-wrap: wrap; /* Wraps if the buttons don't fit */
    justify-content: center; /* Centers the buttons horizontally */
    gap: 10px; /* Adds spacing between buttons */
  }

  /* Ensure all links have the same width */
  a {
    display: flex;
    justify-content: space-between; /* Pushes text left and icon right */
    align-items: center;
    width: 130px; /* Consistent width for all buttons */
    padding: 12px 10px;
    background: rgba(52, 202, 239, 0.8);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.7);
    transition: all 0.3s ease;
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 1px;
    margin-top: 19px;
    text-align: left; /* Ensures text stays aligned nicely */
  }

  

  /* Mobile heading styling */
  h2 {
    color: #fff;
    text-align: center;
  }
}



  </style>
</head>

<body>
  <div>
  <h2>Admin Panel</h2>
  <a href="home.html" target="main"><span>Dashboard</span><span>üè†</span></a>
  <a href="Station.html" target="main"><span>Create Station</span><span>‚ûï</span></a>
  <a href="manage.html" target="main"><span>View Stations</span><span>üìç</span></a>

  <!-- Dynamic stations will go here -->
  <div id="stationsContainer"></div>

  <a href="profile.html" target="main"><span>Profile</span><span>üë§</span></a>
</div>

<script>
  const stationsContainer = document.getElementById("stationsContainer");


function addStationLink(station, isBooking) {
  const link = document.createElement("a");
  link.href = `check.html?id=${station._id}`;
  link.target = "main";
  link.style.position = "relative";
  link.style.display = "flex";
  link.style.justifyContent = "space-between";
  link.style.alignItems = "center";
  link.style.width = "130px";
  link.style.padding = "12px 10px";
  link.style.borderRadius = "8px";
  link.style.boxShadow = "0 4px 8px rgba(0,0,0,0.7)";
  link.style.transition = "all 0.3s ease";
  link.style.fontSize = "13px";
  link.style.fontWeight = "bold";
  link.style.letterSpacing = "1px";
  link.style.color = "#fff";
  link.style.textDecoration = "none";
  link.style.marginTop = "15px";

  const spanText = document.createElement("span");
  spanText.textContent = station.name;
  link.appendChild(spanText);
  stationsContainer.appendChild(link);

  console.log("isBooking value for station", station._id, ":", isBooking);
  if (!isBooking) {

    link.style.background = "lightgrey";
    link.style.color = "#555";
    return; 
  }
  let hasBookings = false;

   link.style.background = "red";
  link.style.color = "#fff";
  fetch(`http://localhost:3000/stations/${station._id}/bookings/unseen`)
    .then(res => res.json())
    .then(data => {
      const count = data.count;
      const length = data.length;
      hasBookings = length > 0;


      link.style.background = hasBookings ? "rgba(52, 202, 239, 0.8)" : "aqua";
      link.style.color = hasBookings ? "#fff" : "#555";

      if (count > 0) {
        const badge = document.createElement("span");
        badge.textContent = count > 9 ? "9+" : count;
        badge.style.position = "absolute";
        badge.style.top = "5px";
        badge.style.right = "5px";
        badge.style.background = "red";
        badge.style.color = "#fff";
        badge.style.fontSize = "10px";
        badge.style.fontWeight = "bold";
        badge.style.borderRadius = "50%";
        badge.style.padding = "2px 6px";
        badge.classList.add("booking-badge");
        link.appendChild(badge);
      }
    })
    .catch(err => console.error(err));

  link.addEventListener("mouseenter", () => {
    link.style.background = "rgba(56, 142, 60, 0.9)";
    link.style.color = "#fff";
    link.style.transform = "translateY(-2px)";
  });

  link.addEventListener("mouseleave", () => {
  if (!isBooking) {
    link.style.background = "lightgrey";
    link.style.color = "#555";
  } else if (!hasBookings) {
    link.style.background = "aqua";
    link.style.color = "#555";
  } else {
    link.style.background = "rgba(52, 202, 239, 0.8)";
    link.style.color = "#fff";
  }
  link.style.transform = "translateY(0)";
});

  link.addEventListener("click", () => {
    const badge = link.querySelector(".booking-badge");
    if (badge) badge.remove();
    fetch(`http://localhost:3000/stations/${station._id}/bookings/mark-seen`, { method: "POST" })
      .catch(err => console.error(err));
  });
}

/*

  window.addEventListener("DOMContentLoaded", () => {
    
    fetch("http://localhost:3000/api/stations")

      .then(res => res.json())
      .then(data => data.forEach(station => addStationLink(station,isbooking)))
      .catch(err => console.error(err));
  });

  */
  window.addEventListener("DOMContentLoaded", () => {
  fetch("http://localhost:3000/api/stations")
    .then(res => res.json())
    .then(data => {
      console.log("Stations data:", data);
      data.forEach(station => {
        // Fetch isbooking for each station
        fetch(`http://localhost:3000/stations/${station._id}/isbooking`)
          .then(res => res.json())
          .then(isbookingData => {
            const isbooking = isbookingData.message;
            console.log(isbooking);
            addStationLink(station, isbooking); // Pass both station and isbooking
          })
          .catch(err => {
            console.error(err);
            addStationLink(station, false); // Default to false if error
          });
      });
    })
    .catch(err => console.error(err));
});

  window.addEventListener("message", (event) => {
    if (event.data.type === "NEW_STATION") {
      addStationLink(event.data.station);
    }
  });
</script>

</body>

</html>
